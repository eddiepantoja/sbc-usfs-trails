define(["esri/layers/FeatureLayer","esri/config","esri/tasks/support/Query","esri/tasks/QueryTask","esri/geometry/Polyline","esri/geometry/geometryEngine","dojo/Deferred","dojo/dom-construct","esri/WebScene","esri/views/SceneView","esri/widgets/NavigationToggle","esri/widgets/Zoom","esri/widgets/Compass","esri/renderers/UniqueValueRenderer","esri/symbols/LineSymbol3D","esri/symbols/LineSymbol3DLayer","esri/symbols/LabelSymbol3D","esri/layers/support/LabelClass","esri/symbols/TextSymbol3DLayer","esri/core/Accessor","esri/core/accessorSupport/decorators"],function(e,t,n,r,i,o,s,a,l,u,c,f,p,d,h,y,v,g,m,b,w){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={scene:{websceneItemId:"55a58b5d8a3048309def0db95a8a0571"},data:{trailsServiceUrl:"http://services.arcgis.com/aA3snZwJfFkVyDuP/arcgis/rest/services/Vision2BActive_USFS_Trails/FeatureServer/0",trailAttributes:{NAME:"Name",TRAIL_CLASS:"Trail Class",Length_Miles:"Length in Miles",Steps_to_Travel:"Steps to Travel",ID:"Route ID"}},colors:{defaultTrail:"#db5353",selectedTrail:"#f9a352"}}},function(e,n){e.exports=t},function(e,t,n){e.exports=n(3)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(4),n(1).request.useIdentity=!1;var r=n(5),i=n(8),o=n(24),s=new r.default;new i.default(s),o.default.initTrails(s).then(function(){})},function(e,t){},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(7),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.displayLoading=!0,t.selectedTrailId=null,t.currentBasemapId=null,t.view=null,t.trails=null,t.online=!0,t}return r(t,e),t.prototype.setSelectedTrailId=function(e){this.selectedTrailId=e},i([s.property()],t.prototype,"displayLoading",void 0),i([s.property()],t.prototype,"selectedTrailId",void 0),i([s.property()],t.prototype,"currentBasemapId",void 0),i([s.property()],t.prototype,"view",void 0),i([s.property()],t.prototype,"trails",void 0),i([s.property()],t.prototype,"online",void 0),t=i([s.subclass()],t)}(s.declared(o));t.default=a},function(e,t){e.exports=b},function(e,t){e.exports=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(9),o=n(16),s=n(17),a=n(18),l=n(19),u=n(20),c=n(21),f=n(22),p=n(1);n(23),p.request.corsEnabledServers.push("wtb.maptiles.arcgis.com");var d=function(){function e(e){var t=this;this.state=e,this.view=this.initView(),this.state.view=this.view,this.trailsLayer=this.initTrailsLayer(),this.view.when(function(){t.view.map.add(t.trailsLayer)}),this.view.on("click",function(e){t.onViewClick(e)}),window.view=this.view,e.watch("selectedTrailId",function(e,n){n&&t.unselectFeature(n),e&&t.selectFeature(e)}),e.watch("currentBasemapId",function(e){t.setCurrentBasemap(e)})}return e.prototype.initView=function(){var e=new s({portalItem:{id:r.default.scene.websceneItemId}}),t=new a({container:"scenePanel",map:e,constraints:{tilt:{max:80,mode:"manual"}},qualityProfile:"high",environment:{lighting:{directShadowsEnabled:!0,ambientOcclusionEnabled:!0},atmosphereEnabled:!0,atmosphere:{quality:"high"},starsEnabled:!1},ui:{components:["attribution"]},padding:{right:300},popup:{dockEnabled:!1,collapsed:!0}}),n=new u({view:t}),i=new c({view:t}),o=new f({view:t});return t.ui.add([i,n,o],"top-left"),t},e.prototype.initTrailsLayer=function(){return new l({url:r.default.data.trailsServiceUrl,title:"San Bernardino County USFS Trails",outFields:["*"],renderer:i.getTrailRenderer(),elevationInfo:{mode:"on-the-ground"},labelsVisible:!0,popupEnabled:!1,labelingInfo:i.getLabelingInfo({selection:null})})},e.prototype.setCurrentBasemap=function(e){this.view.map.layers.filter(function(e){return"Basemap"===e.title}).getItemAt(0).layers.filter(function(t){return t.id===e}).getItemAt(0).visible=!0},e.prototype.onViewClick=function(e){var t=this;this.state.online&&(console.log("Map Clicked"),this.showLoadingIcon(e),this.view.hitTest(e).then(function(e){var n=e.results[0],i=t.trailsLayer.createQuery();i.geometry=n.mapPoint,i.distance=100,i.units="meters",i.spatialRelationship="intersects",t.trailsLayer.queryFeatures(i).then(function(e){e.features.length>0?(console.log(JSON.stringify(e)),t.state.setSelectedTrailId(e.features[0].attributes[r.default.data.trailAttributes.ID])):t.state.setSelectedTrailId(null),t.removeLoadingIcon()}).catch(function(e){return console.log(e)})}))},e.prototype.showLoadingIcon=function(e){o.create("span",{class:"fa fa-spinner fa-spin",id:"loadingIcon",style:{position:"absolute",fontSize:"30px",top:e.screenPoint.y-15+"px",left:e.screenPoint.x-15+"px"}},document.body)},e.prototype.removeLoadingIcon=function(){o.destroy("loadingIcon")},e.prototype.selectFeature=function(e){var t=this.trailsLayer.renderer.clone();t.uniqueValueInfos=i.getUniqueValueInfos({selection:e}),this.trailsLayer.renderer=t,this.trailsLayer.labelingInfo=i.getLabelingInfo({selection:e});var n=this.state.trails.filter(function(t){return t.ID===e})[0];this.view.goTo({target:n.geometry,tilt:60},{speedFactor:.5}),this.state.online&&n.setElevationValuesFromService()},e.prototype.unselectFeature=function(e){var t=this.trailsLayer.renderer.clone();t.uniqueValueInfos=[],this.trailsLayer.renderer=t,this.trailsLayer.labelingInfo=i.getLabelingInfo({selection:null}),this.state.trails.filter(function(t){return t.ID===e})[0]},e}();t.default=d},function(e,t,n){"use strict";function r(e){var t=e.selection?o.default.colors.selectedTrail:o.default.colors.defaultTrail,n=e.selection?4:2;return new a({symbolLayers:[new l({material:{color:t},size:n})]})}function i(e){var t=e.selection?o.default.colors.selectedTrail:o.default.colors.defaultTrail,n=new c({symbol:new u({symbolLayers:[new f({material:{color:"white"},halo:{color:t,size:1},font:{family:"Open Sans Condensed",weight:"bold"},size:13})],verticalOffset:{screenLength:80,maxWorldLength:2e3,minWorldLength:500},callout:{type:"line",size:1,color:"white",border:{color:t}}}),labelPlacement:"above-center",labelExpressionInfo:{expression:"$feature."+o.default.data.trailAttributes.NAME}});return e.selection&&(n.where=o.default.data.trailAttributes.ID+" = "+e.selection),n}Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(10),a=n(11),l=n(12),u=n(13),c=n(14),f=n(15);t.getTrailRenderer=function(){return new s({field:o.default.data.trailAttributes.ID,defaultSymbol:r({selection:null}),uniqueValueInfos:[]})},t.getUniqueValueInfos=function(e){if(e.selection)return[{value:e.selection,symbol:r(e)}]},t.getLabelingInfo=function(e){return e.selection?[i(e),i({})]:[i({})]},t.createLabelClass=i},function(e,t){e.exports=d},function(e,t){e.exports=h},function(e,t){e.exports=y},function(e,t){e.exports=v},function(e,t){e.exports=g},function(e,t){e.exports=m},function(e,t){e.exports=a},function(e,t){e.exports=l},function(e,t){e.exports=u},function(t,n){t.exports=e},function(e,t){e.exports=c},function(e,t){e.exports=f},function(e,t){e.exports=p},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(25),o=n(26),s=n(27),a={initTrails:function(e){return function(){var e=new i({outFields:["*"],where:"1=1",returnGeometry:!0,outSpatialReference:{wkid:4326}});return new o({url:r.default.data.trailsServiceUrl}).execute(e)}().then(function(t){e.trails=t.features.map(function(t){return new s.default(t,e)})}).catch(function(e){console.log(e)})}};t.default=a},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(28),o=n(29),s=n(30),a=function(){function e(e,t){this.geometry=e.geometry,this.state=t,this.elevationIsSet=null;var n=r.default.data.trailAttributes;for(var i in n)this[i]=e.attributes[n[i]]}return e.prototype.setElevationValuesFromService=function(){var e=this;return this.elevationIsSet||(this.elevationIsSet=new s,this.state.view.map.ground.layers.getItemAt(0).queryElevation(this.geometry,{demResolution:"finest-contiguous"}).then(function(t){var n;e.geometry=t.geometry,n=e.getProperties(),e.profileData=n[0],e.segments=n[1],e.elevationIsSet.resolve(1)})),this.elevationIsSet.promise},e.prototype.getProperties=function(){var e,t,n=[],r=0,i=0,o=this.getLongestPath(),s=[o[0]],a=0;for(n.push({point:o[0],length:r,value:Math.round(o[0][2])});a<o.length;){for(e=a+1;e<o.length;e++){var l=this.computeLength(o.slice(a,e+1));if((i+=l)>2e3&&this.computeLength([s[s.length-1],o[e]])>1e3&&(s.push(o[e]),i=0),l>150){r+=l,n.push({point:o[e],length:Math.round(r/100)/10,value:Math.round(o[a][2])});break}}a=e}for(t=0;t<n.length;t++)this.minElevation>n[t][2]&&(this.minElevation=n[t][2]),this.maxElevation<n[t][2]&&(this.maxElevation=n[t][2]);return[n,s,this.minElevation,this.maxElevation]},e.prototype.getLongestPath=function(){for(var e=null,t=0,n=0,r=this.geometry.paths;n<r.length;n++){var i=r[n],o=this.computeLength(i);o>t&&(t=o,e=i)}return e},e.prototype.computeLength=function(e){return o.geodesicLength(new i({paths:[e],hasZ:!0,spatialReference:{wkid:4326}}),"meters")},e}();t.default=a},function(e,t){e.exports=i},function(e,t){e.exports=o},function(e,t){e.exports=s}])});
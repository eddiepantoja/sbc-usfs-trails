define(["esri/Map","esri/config","dojo/dom","dojo/on","dojo/dom-construct","esri/layers/GraphicsLayer","esri/geometry/geometryEngine","esri/Graphic","esri/tasks/support/Query","esri/tasks/QueryTask","esri/views/SceneView","esri/layers/FeatureLayer","esri/widgets/NavigationToggle","esri/widgets/Zoom","esri/widgets/Compass","esri/renderers/UniqueValueRenderer","esri/symbols/LineSymbol3D","esri/symbols/LineSymbol3DLayer","esri/symbols/LabelSymbol3D","esri/layers/support/LabelClass","esri/symbols/TextSymbol3DLayer","esri/core/Accessor","esri/core/accessorSupport/decorators"],function(e,t,i,n,r,o,s,a,l,u,c,d,f,p,v,h,g,y,m,b,w,L,_){return function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={data:{trailsServiceUrl:"http://services.arcgis.com/aA3snZwJfFkVyDuP/ArcGIS/rest/services/Vision2BActive_USFS_Trails/FeatureServer/0",trailAttributes:{name:"NAME",id:"ID",trail_class:"TRAIL_CLASS",length_miles:"Length_Miles",steps_to_travel:"Steps_to_Travel"}},colors:{defaultTrail:{path:"#E83A2B",halo:"#7D0000"},selectedTrail:{path:"#D2A002",halo:"#7A5100"}}}},function(e,t){e.exports=r},function(e,i){e.exports=t},function(e,t,i){e.exports=i(4)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(5),i(2).request.useIdentity=!1;var n=i(6),r=i(9),o=i(10),s=i(25),a=i(29),l=i(37);"serviceWorker"in navigator&&l.register();var u=new n.default,c=(new r.default(u),new o.default(u));s.default.initTrails(u).then(function(){new a.default(u,c)})},function(e,t){},function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s};Object.defineProperty(t,"__esModule",{value:!0});var o=i(7),s=i(8),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.displayLoading=!0,t.selectedTrailId=null,t.trailRoute=null,t.currentBasemapId=null,t.view=null,t.trails=null,t.online=!0,t}return n(t,e),t.prototype.setSelectedTrailId=function(e){this.selectedTrailId=e},t.prototype.setTrailRoutes=function(e){this._get("trailRoute")!==e&&this._set("trailRoute",e)},r([s.property()],t.prototype,"displayLoading",void 0),r([s.property()],t.prototype,"selectedTrailId",void 0),r([s.property()],t.prototype,"trailRoute",void 0),r([s.property()],t.prototype,"currentBasemapId",void 0),r([s.property()],t.prototype,"view",void 0),r([s.property()],t.prototype,"trails",void 0),r([s.property()],t.prototype,"online",void 0),t=r([s.subclass()],t)}(s.declared(o));t.default=a},function(e,t){e.exports=L},function(e,t){e.exports=_},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(1),r=function(){function e(e){var t=this;window.addEventListener("load",function(){function t(t){e.online=!!navigator.onLine}window.addEventListener("online",t),window.addEventListener("offline",t)}),this.messageContainer=n.create("div",{},document.body),e.watch("online",function(e){console.log(e),e?t.createOnlineMessage():t.createOfflineMessage()})}return e.prototype.createOfflineMessage=function(){this.setMessage("You seem to be offline. This application has limited functionality.",!1)},e.prototype.createOnlineMessage=function(){this.setMessage("You are back online.",!0)},e.prototype.setMessage=function(e,t){var i=this;this.messageContainer.innerHTML=e,this.messageContainer.classList.add("connectionMessage"),t?(this.messageContainer.classList.add("online"),this.messageContainer.classList.remove("offline"),window.setTimeout(function(){i.messageContainer.innerHTML="",i.messageContainer.classList.remove("online","connectionMessage")},3e3)):(this.messageContainer.classList.remove("online"),this.messageContainer.classList.add("offline"))},e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),r=i(11),o=i(1),s=i(18),a=i(19),l=i(20),u=i(21),c=i(22),d=i(23),f=i(2);i(24),f.request.corsEnabledServers.push("wtb.maptiles.arcgis.com");var p=function(){function e(e){var t=this;this.state=e,this.view=this.initView(),this.state.view=this.view,this.trailsLayer=this.initTrailsLayer(),this.view.when(function(){t.view.map.add(t.trailsLayer)}),this.view.on("click",function(e){t.onViewClick(e),t.trailsLayer}),window.view=this.view,e.watch("selectedTrailId",function(e,i){i&&t.unselectFeature(i),e&&t.selectFeature(e)})}return e.prototype.initView=function(){var e=new s({basemap:"satellite",ground:"world-elevation"}),t=new a({container:"scenePanel",map:e,camera:{position:{x:-116.9,y:33.65,z:25e3},tilt:70},zoom:10,constraints:{tilt:{max:80,mode:"manual"}},qualityProfile:"high",environment:{lighting:{directShadowsEnabled:!0,ambientOcclusionEnabled:!0},atmosphereEnabled:!0,atmosphere:{quality:"high"},starsEnabled:!1},ui:{components:["attribution"]},padding:{right:300},popup:{visible:!1}}),i=new u({view:t}),n=new c({view:t}),r=new d({view:t});return t.ui.add([n,i,r],"top-left"),t},e.prototype.initTrailsLayer=function(){return new l({url:n.default.data.trailsServiceUrl,title:"San Bernardino County USFS Trails",outFields:["*"],renderer:r.getTrailRenderer(),elevationInfo:{mode:"on-the-ground"},labelsVisible:!0,labelingInfo:r.getLabelingInfo({selection:null}),popupEnabled:!1})},e.prototype.onViewClick=function(e){var t=this;this.state.online&&(this.showLoadingIcon(e),this.view.hitTest(e).then(function(e){t.view.popup.close();var i=e.results[0],r=t.trailsLayer.createQuery();r.geometry=i.mapPoint,r.distance=200,r.units="meters",r.spatialRelationship="intersects",t.trailsLayer.queryFeatures(r).then(function(e){e.features.length>0?t.state.setSelectedTrailId(e.features[0].attributes[n.default.data.trailAttributes.id]):t.state.setSelectedTrailId(null),t.removeLoadingIcon()}).catch(function(e){return console.log(e)})}))},e.prototype.showLoadingIcon=function(e){o.create("span",{class:"fa fa-spinner fa-spin",id:"loadingIcon",style:{position:"absolute",fontSize:"40px",top:e.screenPoint.y-15+"px",left:e.screenPoint.x-15+"px"}},document.body)},e.prototype.removeLoadingIcon=function(){o.destroy("loadingIcon")},e.prototype.selectFeature=function(e){var t=this.trailsLayer.renderer.clone();t.uniqueValueInfos=r.getUniqueValueInfos({selection:e}),this.trailsLayer.renderer=t,this.trailsLayer.labelingInfo=r.getLabelingInfo({selection:e});var i=this.state.trails.filter(function(t){return t.id===e})[0];this.view.goTo({target:i.geometry,tilt:60},{speedFactor:.5})},e.prototype.unselectFeature=function(e){var t=this.trailsLayer.renderer.clone();t.uniqueValueInfos=[],this.trailsLayer.renderer=t,this.trailsLayer.labelingInfo=r.getLabelingInfo({selection:null}),this.state.trails.filter(function(t){return t.id===e})[0]},e}();t.default=p},function(e,t,i){"use strict";function n(e){var t=e.selection?o.default.colors.selectedTrail:o.default.colors.defaultTrail,i=e.selection?4:2;return new a({symbolLayers:[new l({material:{color:t.path},size:i})]})}function r(e){var t=e.selection?o.default.colors.selectedTrail:o.default.colors.defaultTrail,i=new c({symbol:new u({symbolLayers:[new d({material:{color:"white"},halo:{color:t.halo,size:1.3},font:{family:"Arial, Helvetica, sans-serif",weight:"bold"},size:13})],verticalOffset:{screenLength:80,maxWorldLength:2e3,minWorldLength:500},callout:{type:"line",size:2,color:"white",border:{color:t.halo}}}),labelPlacement:"above-center",labelExpressionInfo:{expression:"$feature."+o.default.data.trailAttributes.name}});return e.selection&&(i.where=o.default.data.trailAttributes.id+" = "+e.selection),i}Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),s=i(12),a=i(13),l=i(14),u=i(15),c=i(16),d=i(17);t.getTrailRenderer=function(){return new s({field:o.default.data.trailAttributes.id,defaultSymbol:n({selection:null}),uniqueValueInfos:[]})},t.getUniqueValueInfos=function(e){if(e.selection)return[{value:e.selection,symbol:n(e)}]},t.getLabelingInfo=function(e){return e.selection?[r(e),r({})]:[r({})]},t.createLabelClass=r},function(e,t){e.exports=h},function(e,t){e.exports=g},function(e,t){e.exports=y},function(e,t){e.exports=m},function(e,t){e.exports=b},function(e,t){e.exports=w},function(t,i){t.exports=e},function(e,t){e.exports=c},function(e,t){e.exports=d},function(e,t){e.exports=f},function(e,t){e.exports=p},function(e,t){e.exports=v},function(e,t){},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),r=i(26),o=i(27),s=i(28),a={initTrails:function(e){return function(){var e=new r({outFields:["*"],where:"1=1",returnGeometry:!0,outSpatialReference:{wkid:4326}});return new o({url:n.default.data.trailsServiceUrl}).execute(e)}().then(function(t){e.trails=t.features.map(function(t){return new s.default(t,e)})}).catch(function(e){console.log(e)})}};t.default=a},function(e,t){e.exports=l},function(e,t){e.exports=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),r=function(){return function(e,t){this.geometry=e.geometry,this.state=t,this.elevationIsSet=null;var i=n.default.data.trailAttributes;for(var r in i)this[r]=e.attributes[i[r]]}}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(30),r=i(31),o=i(1),s=i(32),a=i(33);i(36);var l=function(){function e(e,t){var i=this;this.state=e,this.trails=e.trails,this.detailsContainer=n.byId("detailPanel"),this.routesContainer=n.byId("routesPanel"),this.emptyDetails();var o=new s;e.watch("selectedTrailId",function(e){if(o.removeAll(),i.emptyDetails(),e){var t=i.trails.filter(function(t){return t.id===e})[0];i.displayInfo(t),i.addRouteEvent(i.state,i.trails)}}),e.watch("trailRoute",function(e){var t=e;localStorage.setItem("trailRoute",JSON.stringify(t)),i.displayRoutes(a.getIntersectingTrails(e))});var l=JSON.parse(localStorage.getItem("trailRoute"));l&&(this.state.trailRoute=l),t.view.map.add(o),r(document.querySelector("#routesPanel"),".removeTrail:click",function(t){var i=t.target.dataset.trailid,n=e.trailRoute;n&&(n.forEach(function(e,t){e.id===i&&n.splice(t,1)}),e.setTrailRoutes(n.slice()))}),r(document.querySelector("#routesPanel"),".no-group:click",function(t){var i=t.target.dataset.trailid;e.setSelectedTrailId(i)}),r(document.querySelector("#routesPanel"),".group:click",function(i){var n=i.target.dataset.trailid;if(n)e.setSelectedTrailId(n);else{o.removeAll();var r=a.createRouteSymbol(i,e.trails);o.add(r),t.view.goTo({target:r,tilt:60},{speedFactor:.5})}})}return e.prototype.addRouteEvent=function(e,t){r(document.querySelector("#addRoute"),"click",function(i){var n=i.target.dataset.trailid,r=t.filter(function(e){return e.id===n})[0],o=e.trailRoute;o?o.some(function(e){return e.id===n})||(o.push(r),e.setTrailRoutes(o.slice())):e.setTrailRoutes(new Array(r))})},e.prototype.emptyDetails=function(){o.empty(this.detailsContainer),this.displayAppInfo()},e.prototype.displayAppInfo=function(){this.detailsContainer.innerHTML="<div class='detail-placeholder'>Select a trail to see details.</div>"},e.prototype.displayInfo=function(e){this.detailsContainer.innerHTML='\n            <div class="detailContent">\n                <div id="detailTitle">'+e.name+'</div>\n                <div id="detailClass">Class: '+e.trail_class+'</div>\n                <div class="row">\n                  <div id="detailLength" class="column"><i class="fas fa-route"></i><br />'+e.length_miles.toLocaleString("en",{maximumFractionDigits:2})+' mi</div>\n                  <div id="detailSteps" class="column"><i class="fas fa-shoe-prints"></i><br />'+e.steps_to_travel.toLocaleString("en",{maximumFractionDigits:2})+'</div>\n                </div>\n                <button id="addRoute" data-trailId="'+e.id+'">Add to Route</button>\n            </div>\n        '},e.prototype.displayRoutes=function(e){var t=e.intersections.noGroups,i=e.intersections.groups,n="";i.length>=1&&i.forEach(function(e,t){var i=0,r=0,o=[];e.forEach(function(e){o.push(e.id)}),n+='\n                  <div class="route group group-'+(t+1)+'" data-routeIDs="'+o+'">\n                    <div class="route-heading">Route '+(t+1)+"</div>\n                ",e.forEach(function(e){i+=e.length_miles,r+=e.steps_to_travel,n+='\n                      <div class="group-single" data-trailID="'+e.id+'">\n                        <div class="routeTitle">'+e.name+'</div>\n                        <i class="far fa-window-close removeTrail" data-trailID="'+e.id+'"></i>\n                      </div>'}),n+='\n                    <div class="row">\n                      <div class="routeLength column"><i class="fas fa-route"></i><br />'+i.toLocaleString("en",{maximumFractionDigits:2})+' mi</div>\n                      <div class="routeSteps column"><i class="fas fa-shoe-prints"></i><br />'+r.toLocaleString("en",{maximumFractionDigits:2})+"</div>\n                    </div>\n                  </div>\n                "}),t.length>=1&&(n+='<div class="route-heading no-route">Not in Route</div>',t.forEach(function(e,t){n+='\n                  <div class="route no-group no-group-'+(t+1)+'" data-trailID="'+e.id+'">\n                    <div class="routeTitle">'+e.name+'</div>\n                    <div class="routeClass">Class: '+e.trail_class+'</div>\n                    <div class="row">\n                      <div class="routeLength column"><i class="fas fa-route"></i><br />'+e.length_miles.toLocaleString("en",{maximumFractionDigits:2})+' mi</div>\n                      <div class="routeSteps column"><i class="fas fa-shoe-prints"></i><br />'+e.steps_to_travel.toLocaleString("en",{maximumFractionDigits:2})+'</div>\n                    </div>\n                    <i class="far fa-window-close removeTrail" data-trailID="'+e.id+'"></i>\n                  </div>\n                '})),this.routesContainer.innerHTML=n},e}();t.default=l},function(e,t){e.exports=i},function(e,t){e.exports=n},function(e,t){e.exports=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(34),r=i(35);t.getIntersectingTrails=function(e){var t,i=[],r=[],a=[],l=[],u={};if(e.length>1){for(var c=0;c<e.length-1;c++)for(var d=c+1;d<e.length;d++){var f=e[c].geometry,p=e[d].geometry;n.intersects(f,p)&&i.push([e[c].id,e[d].id])}var v=o(i);for(t in v)v.hasOwnProperty(t)&&!u[t]&&a.push(s(t,v,u));a.forEach(function(t){for(var i=[],n=0,o=t;n<o.length;n++)for(var s=o[n],a=0,l=e;a<l.length;a++){var u=l[a];if(u.id===s){i.push(u);break}}r.push(i)});var h=[].concat.apply([],a);e.forEach(function(e){h.includes(e.id)||l.push(e)})}else 1===e.length&&l.push(e[0]);return{intersections:{groups:r,noGroups:l}}};var o=function(e){var t,i,n,r,o,s={};for(t=0,i=e.length;t<i;t+=1)r=(n=e[t])[0],o=n[1],s[r]?s[r].push(o):s[r]=[o],s[o]?s[o].push(r):s[o]=[r];return s},s=function(e,t,i){var n,r,o,s,a=[],l=[];for(a.push(e),i[e]=!0;a.length>0;)for(e=a.shift(),l.push(e),n=0,r=(o=t[e]).length;n<r;n+=1)i[s=o[n]]||(a.push(s),i[s]=!0);return l};t.createRouteSymbol=function(e,t){var i=[],o=e.target.dataset.routeids;(o=o.split(",")).forEach(function(e){i.push(t.filter(function(t){return t.id===e})[0].geometry)});var s=n.union(i);return new r({geometry:s,symbol:{type:"simple-line",color:[33,237,111],width:5},attributes:{Name:"Route"}})}},function(e,t){e.exports=s},function(e,t){e.exports=a},function(e,t){},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default={register:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!!navigator.serviceWorker&&navigator.serviceWorker.register("/sbc-usfs-trails/dist/../sw.js",e)}},e.exports=t.default}])});